# Firewall

/ip firewall filter {
  remove [ find where !dynamic ]

  add chain=input connection-state=established,related,untracked action=accept
  add chain=input in-interface-list=lan action=accept
  add chain=input protocol=icmp action=accept
  add chain=input action=drop

  add chain=forward connection-state=established,related action=fasttrack-connection
  add chain=forward connection-state=established,related,untracked action=accept
  add chain=forward in-interface-list=!lan action=drop
}

/ipv6 firewall filter {
  remove [ find where !dynamic ]

  add chain=input connection-state=established,related,untracked action=accept
  add chain=input in-interface-list=lan action=accept
  add chain=input protocol=icmpv6 action=accept
  add chain=input protocol=udp port=33434-33534 action=accept \
    comment="Accept UDP traceroute"
  add chain=input protocol=udp dst-port=500,4500 action=accept \
    comment="Accept Internet Key Exchange"
  add chain=input action=drop

  add chain=forward connection-state=established,related action=accept
  add chain=forward protocol=icmpv6 action=accept disabled=yes
  add chain=forward protocol=139 action=accept disabled=yes \
    comment="Accept Host Identity Protocol"
  add chain=forward protocol=udp dst-port=500,4500 action=accept disabled=yes \
    comment="Accept Internet Key Exchange"
  add chain=forward in-interface-list=!lan action=drop
}

/ip firewall service-port {
  set [ find where name!=udplite && name!=dccp && name!=sctp ] disabled=yes
}
